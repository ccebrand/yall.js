export default function(e){const o=(e=e||{}).lazyClass||"lazy",t=e.lazyBackgroundClass||"lazy-bg",a="idleLoadTimeout"in e?e.idleLoadTimeout:200,n=e.observeChanges||!1,r=e.events||{},s=window,i="requestIdleCallback",l="IntersectionObserver",d=["srcset","src","poster"],c=[],u=(e,a)=>c.slice.call((a||document).querySelectorAll(e||"img."+o+",video."+o+",iframe."+o+",."+t)),b=o=>{const a=o.parentNode;let n;"PICTURE"===a.nodeName&&(n=a),"VIDEO"===o.nodeName&&(n=o),n&&u("source",n).forEach(e=>{f(e)}),f(o),o.autoplay&&o.load();const r=o.classList;r.contains(t)&&(r.remove(t),r.add(e.lazyBackgroundLoaded||"lazy-bg-loaded"))},v=e=>{for(let o in r)e.addEventListener(o,r[o].listener||r[o],r[o].options||void 0);h.observe(e)},f=e=>{d.forEach(o=>{o in e.dataset&&s.requestAnimationFrame(()=>{e[o]=e.dataset[o]})})};let g=u();if(/baidu|(?:google|bing|yandex|duckduck)bot/i.test(navigator.userAgent))g.forEach(e=>{v(e)});else if(l in s&&l+"Entry"in s){var h=new s[l]((e,t)=>{e.forEach(e=>{if(e.intersectionRatio){const r=e.target;i in s&&a?s[i](()=>{b(r)},{timeout:a}):b(r),r.classList.remove(o),t.unobserve(r),(g=g.filter(e=>e!=r)).length||n||h.disconnect()}})},{rootMargin:("threshold"in e?e.threshold:200)+"px 0%"});g.forEach(e=>{v(e)}),n&&new MutationObserver(()=>{u().forEach(e=>{g.indexOf(e)<0&&(g.push(e),v(e))})}).observe(u(e.observeRootSelector||"body")[0],e.mutationObserverOptions||{childList:!0,subtree:!0})}}
